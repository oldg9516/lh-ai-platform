# Lev Haolam — AI Support Chat Platform
## Архитектура системы

---

## 1. Что мы строим

Интеллектуальная платформа живого чата для клиентской поддержки Lev Haolam, которая:

- **Общается с клиентами в реальном времени** через чат-виджет на сайте, WhatsApp, Facebook, Email — из единого центра
- **Автоматически понимает и классифицирует** запросы клиентов (10 категорий: отмена, пауза, доставка, повреждения и т.д.)
- **Выполняет действия** — пауза подписки, смена адреса, пропуск месяца, создание damage claim — с подтверждением клиента
- **Учится и улучшается** — система накапливает знания и паттерны, становясь точнее с каждым разговором
- **Оценивает качество** — автоматическая оценка ответов, сравнение моделей, A/B тестирование на исторических данных
- **Даёт аналитику** — "сколько тикетов обработал AI?", "какая категория самая проблемная?" — вопрос на естественном языке → ответ с графиками

### Чем отличается от текущей системы

| | Текущая система (email pipeline) | Новая платформа (live chat) |
|---|---|---|
| Канал | Только email | Чат на сайте + WhatsApp + Facebook + Email |
| Скорость ответа | Минуты-часы (draft → review → send) | Секунды (real-time) |
| Действия | AI пишет текст, человек выполняет | AI выполняет действия сам (с подтверждением) |
| Обучение | Статичные промпты | Самообучение: каждый разговор улучшает систему |
| Аналитика | SQL запросы вручную | "Спроси AI" — вопрос → insight |
| Масштаб | 10 категорий, 1 auto-send | 10+ категорий, все auto-capable |

---

## 2. Архитектура: 5 сервисов

Система состоит из 5 независимых сервисов, каждый в своём Docker-контейнере. Они общаются между собой через API, но могут обновляться и масштабироваться независимо.

```
┌─────────────────────────────────────────────────────────────────────┐
│                          КЛИЕНТ                                     │
│                                                                     │
│   Сайт (виджет)    WhatsApp    Facebook    Email    Telegram        │
│        │               │           │         │          │           │
└────────┼───────────────┼───────────┼─────────┼──────────┼───────────┘
         │               │           │         │          │
         ▼               ▼           ▼         ▼          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│               СЕРВИС 1: OMNICHANNEL HUB                             │
│               Единый центр коммуникаций                             │
│                                                                     │
│   • Все каналы в одном окне для агентов                             │
│   • Автоматическая маршрутизация на AI или человека                 │
│   • Готовый виджет чата для встраивания на сайт                     │
│   • История переписки по всем каналам                               │
│   • Handoff: AI → человек (бесшовная передача)                      │
│                                                                     │
└──────────────────────────┬──────────────────────────────────────────┘
                           │ API (webhook / websocket)
                           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│               СЕРВИС 2: AI ENGINE                                    │
│               Ядро AI-системы                                       │
│                                                                     │
│   ┌─────────────┐    ┌──────────────────┐    ┌──────────────────┐  │
│   │   Router     │    │  Support Agent   │    │   Management     │  │
│   │   Agent      │───►│  (динамический)  │    │   Console        │  │
│   │             │    │                  │    │                  │  │
│   │ Классифи-   │    │ Отвечает клиенту │    │ • Chat/Playground│  │
│   │ кация       │    │ Выполняет actions │    │ • Трейсинг      │  │
│   │ запроса     │    │ Использует tools  │    │ • Сессии        │  │
│   │ ~50ms       │    │ Учится           │    │ • Memory viewer  │  │
│   └─────────────┘    └──────────────────┘    │ • Visual Builder │  │
│                                              │ • Версии + Deploy│  │
│   ┌────────────────────────────────────┐     │ • Evals          │  │
│   │         Learning Machine           │     └──────────────────┘  │
│   │                                    │                           │
│   │ • User profiles (persist)          │     Production API:       │
│   │ • Memories (накапливаются)         │     50+ endpoints         │
│   │ • Cross-user learnings (transfer)  │     SSE streaming         │
│   └────────────────────────────────────┘     JWT + RBAC            │
│                                                                     │
└──────────────────────────┬──────────────────────────────────────────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
┌──────────────────┐ ┌──────────┐ ┌───────────────┐
│   Database       │ │ Vector   │ │ External APIs │
│   (PostgreSQL)   │ │ Store    │ │               │
│                  │ │          │ │ • Zoho CRM    │
│ • Сессии        │ │ • FAQ    │ │ • Shipping    │
│ • Memory        │ │ • Примеры│ │ • Payments    │
│ • Traces        │ │ • Docs   │ │ • n8n hooks   │
│ • Instructions  │ │          │ │               │
└──────────────────┘ └──────────┘ └───────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│               СЕРВИС 3: EVAL LAB                                    │
│               Лаборатория качества                                  │
│                                                                     │
│   • Импорт исторических тикетов (CSV) для массового тестирования   │
│   • Side-by-side сравнение моделей на одних данных                  │
│   • LLM-as-Judge: AI оценивает качество ответов по критериям       │
│   • Human annotation: эксперты ревьюят сложные кейсы               │
│   • A/B тестирование промптов: версия A vs B → метрики → winner    │
│   • Custom evaluators: safety compliance, red lines, tone check     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│               СЕРВИС 4: ANALYTICS AGENT                             │
│               Аналитика на естественном языке                       │
│                                                                     │
│   Вопрос: "Сколько тикетов AI обработал за последнюю неделю?"      │
│   → Агент генерирует SQL → выполняет → интерпретирует результат    │
│   → "AI обработал 1,847 тикетов за неделю. Это на 12% больше,     │
│      чем на прошлой неделе. Лидер — категория shipping (34%)."     │
│                                                                     │
│   • Self-learning: больше вопросов → точнее SQL                    │
│   • 6 слоёв контекста: схема, правила, паттерны, learnings         │
│   • Готовые query patterns для ключевых метрик                      │
│   • Интерпретация, а не просто цифры                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│               СЕРВИС 5: WORKFLOW ENGINE (уже работает)               │
│               Автоматизация процессов                               │
│                                                                     │
│   • Email pipeline (текущая система — продолжает работать)          │
│   • Background jobs (мониторинг, алерты)                            │
│   • Data collection и preprocessing                                 │
│   • Telegram алерты                                                 │
│   • Интеграция с внешними сервисами                                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. AI Engine: как работает мозг системы

### Layered Architecture: Router + Dynamic Support Agent

Система использует двухуровневую архитектуру вместо одного "super-агента" или десятка отдельных агентов. Это оптимальный баланс между стоимостью, качеством и простотой.

#### Уровень 1: Router Agent (маршрутизатор)

Лёгкий, быстрый агент. Единственная задача — понять, что хочет клиент.

- **Скорость:** ~50ms
- **Стоимость:** <$0.001 за запрос
- **Что делает:** Классифицирует запрос в одну из 10 категорий, определяет срочность, извлекает email
- **Не отвечает клиенту** — только передаёт данные дальше
- **Multi-action detection:** Если клиент просит два действия одновременно ("отмена + смена адреса") — определяет оба

#### Уровень 2: Support Agent (динамический)

Один агент, но каждый раз "собирается" под конкретную категорию — как актёр, получающий новый сценарий.

В зависимости от категории динамически загружаются:

| Компонент | Что меняется | Пример |
|-----------|-------------|--------|
| **Инструкции** | Правила для этой категории | "При отмене — всегда предложить retention offer" |
| **Tools (действия)** | Только нужные инструменты | Shipping: track_package. Cancel: generate_cancel_link |
| **Модель** | Лучшая модель для задачи | FAQ → быстрая/дешёвая. Retention → глубокая/эмпатичная |
| **Уровень рассуждения** | Глубина анализа | FAQ → минимальный. Payment dispute → глубокий |
| **Knowledge base** | Релевантные примеры и FAQ | Namespace в vector store per category |

#### Трёхслойный промпт (как в текущей системе)

```
Слой 1: УНИВЕРСАЛЬНЫЕ ПРАВИЛА (одинаковые для всех категорий)
  └── Red lines, safety, tone, формат ответа

Слой 2: ПРАВИЛА КАТЕГОРИИ (из БД, per category)
  └── Специфические инструкции: "при damaged_item — запросить фото"

Слой 3: ПРИМЕРЫ (few-shot, из vector store)
  └── Лучшие ответы для этой категории (retrieval по similarity)
```

---

### Полный flow обработки сообщения

```
Клиент: "Hi, I received a damaged item in my last box 
         and also want to skip next month"
              │
              ▼
   ┌─────────────────────────────────────┐
   │  STEP 1: ROUTER                     │
   │                                     │
   │  Результат:                         │
   │  • Primary: damaged_item            │
   │  • Secondary: skip_month            │
   │  • Urgency: medium                  │
   │  • Email: не указан                 │
   │                                     │
   │  Latency: ~50ms | Cost: ~$0.0001   │
   └──────────────┬──────────────────────┘
                  │
                  ▼
   ┌─────────────────────────────────────┐
   │  STEP 2: CUSTOMER IDENTIFICATION    │
   │                                     │
   │  Email не в сообщении → спросить:   │
   │  "Could you share your email so I   │
   │   can look up your account?"        │
   │                                     │
   │  → john@gmail.com → найден:         │
   │  John Smith, subscription #12345    │
   └──────────────┬──────────────────────┘
                  │
                  ▼
   ┌─────────────────────────────────────┐
   │  STEP 3: SUPPORT AGENT             │
   │  (config: damaged_item)             │
   │                                     │
   │  Загружено:                         │
   │  • Instructions: damage rules       │
   │  • Tools: create_claim, request_    │
   │    photos, issue_replacement        │
   │  • Knowledge: damage namespace      │
   │  • Model: быстрая (reasoning: low)  │
   │                                     │
   │  Ответ:                             │
   │  "I'm sorry about the damaged item! │
   │   Could you describe the damage     │
   │   and share a photo?"               │
   │                                     │
   │  → [create_damage_claim]            │
   │  → Виджет: "Создать claim? [Да]"   │
   │                                     │
   │  Затем secondary action:            │
   │  "I also see you'd like to skip     │
   │   next month. Shall I go ahead?"    │
   │                                     │
   │  → [skip_month]                     │
   │  → Виджет: "Пропустить март? [Да]" │
   └──────────────┬──────────────────────┘
                  │
                  ▼
   ┌─────────────────────────────────────┐
   │  STEP 4: EVAL GATE                  │
   │                                     │
   │  Проверка перед отправкой:          │
   │  • Safety rules — OK?              │
   │  • Tone — appropriate?             │
   │  • Actions — correct?              │
   │                                     │
   │  → auto-send / draft / escalate    │
   └─────────────────────────────────────┘
```

---

### Динамический выбор модели per category

| Категория | Модель | Reasoning | Почему |
|-----------|--------|-----------|--------|
| general_question | Быстрая | Минимальный | FAQ, ответ из knowledge base |
| shipping_inquiry | Быстрая | Низкий | Lookup tracking, простая логика |
| change_address | Быстрая | Низкий | Форматирование + confirmation |
| change_frequency | Быстрая | Низкий | Простое действие |
| skip_month | Быстрая | Низкий | Простое действие |
| damaged_item | Быстрая | Низкий | Claim + empathy |
| payment_issue | Быстрая | Средний | Разобраться в деталях |
| pause_subscription | Быстрая | Низкий | Если retention → переключить модель |
| cancel_subscription | **Глубокая** | **Высокий** | Тёплый тон, retention, убеждение |
| complex / other | Аналитическая | Средний | Multi-step reasoning |

**Экономика:** 80-90% запросов → быстрая/дешёвая модель. Только 10-20% (retention, complex) → дорогая. Это экономит ~60-70% бюджета на LLM по сравнению с использованием одной модели для всего.

---

## 4. Omnichannel Hub: единый центр коммуникаций

Отдельный сервис, который объединяет все каналы общения с клиентами.

### Что покрывает

| Канал | Как работает |
|-------|-------------|
| **Виджет на сайте** | Встроенный JavaScript виджет. Кастомизация цветов, текстов, позиции |
| **WhatsApp** | Подключение через WhatsApp Business API. Клиент пишет в WhatsApp → AI отвечает |
| **Facebook Messenger** | Подключение Facebook Page. Сообщения → единое окно |
| **Email** | Входящие email → conversation thread. Ответ → email клиенту |
| **Telegram** | Bot API интеграция |

### Ключевые возможности

- **Единый inbox** — агент видит все каналы в одном окне
- **Автоматическая маршрутизация** — новый разговор → AI Engine (автоматически) → если нужно → человек-агент
- **Бесшовный handoff** — AI не справляется → передача человеку с полным контекстом разговора
- **Теги, приоритеты, SLA** — управление очередями
- **Canned responses** — шаблоны быстрых ответов для агентов
- **CSAT** — автоматический сбор оценки после разговора
- **Отчёты** — resolution time, first response time, satisfaction score
- **Многоязычность** — интерфейс и авто-определение языка клиента

### Взаимодействие с AI Engine

```
Клиент (любой канал)
       │
       ▼
┌──────────────────────┐
│   Omnichannel Hub    │
│                      │
│  Новое сообщение     │
│  → Webhook → AI      │──────► AI Engine API
│                      │         │
│  AI ответил          │◄────────┘
│  → Показать клиенту  │         Ответ + actions
│                      │
│  AI не справился     │
│  → Передать агенту   │──────► Человек-агент
│                      │         (в том же окне)
└──────────────────────┘
```

**Почему отдельный сервис:**
- Покрывает десятки edge cases (reconnection, rate limits, media files, typing indicators)
- Даёт агентам-людям полноценный интерфейс для работы
- AI Engine остаётся чисто AI-системой
- Можно обновлять/масштабировать независимо

---

## 5. Eval Lab: лаборатория качества

Отдельный сервис для глубокого тестирования и оценки AI-системы.

### Зачем нужна, если в AI Engine уже есть evals

AI Engine даёт **оперативные** метрики (трейсинг каждого запроса, latency, cost). Eval Lab даёт **стратегические** — массовое тестирование, сравнение моделей, A/B промптов.

| AI Engine (оперативное) | Eval Lab (стратегическое) |
|------------------------|--------------------------|
| "Этот конкретный ответ — трейс" | "Прогнать 5,000 тикетов за месяц через новый промпт" |
| "Latency этого запроса: 1.2s" | "Модель A vs Модель B на retention — кто лучше?" |
| "Tool calls в этой сессии" | "Промпт v2 лучше v1 на 8% по quality score" |
| Real-time мониторинг | Batch evaluation + отчёты |

### Workflow тестирования

```
┌─────────────────────────────────────────────────────────────┐
│                     EVAL LAB WORKFLOW                         │
│                                                             │
│  1. IMPORT                                                   │
│     Export 5,000 тикетов из PostgreSQL → CSV                │
│     Включая: сообщение клиента, эталонный ответ агента,     │
│     категория, результат                                    │
│                                                             │
│  2. TEST SET                                                 │
│     Upload CSV → создать Test Set                           │
│     Ground truth = эталонные ответы (от лучших агентов)     │
│                                                             │
│  3. RUN                                                      │
│     Прогнать Test Set через AI Engine (через API)           │
│     → 5,000 ответов AI за несколько минут                   │
│                                                             │
│  4. EVALUATE                                                 │
│     • LLM-as-Judge: другой AI оценивает качество            │
│       по критериям: accuracy, tone, safety, completeness    │
│     • Custom evaluators: red lines compliance,              │
│       hallucination detection, action correctness           │
│     • Human review: эксперты проверяют сложные случаи       │
│                                                             │
│  5. COMPARE                                                  │
│     Модель A vs Модель B на том же test set                 │
│     Промпт v1 vs Промпт v2                                 │
│     → Визуальное сравнение, метрики, отчёт                  │
│                                                             │
│  6. DECIDE                                                   │
│     Winner → deploy в production через AI Engine             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Что это даёт бизнесу

- **Уверенность перед запуском:** Не "надеемся что работает", а "протестировано на 5,000 реальных тикетов"
- **Экономия на моделях:** Точное сравнение — где дешёвая модель не хуже дорогой
- **Улучшение со временем:** Каждый месяц — новый test set из production → eval → улучшение
- **Аудит:** Полная история: какой промпт, какая модель, какие результаты

---

## 6. Analytics Agent: аналитика на естественном языке

Отдельный AI-агент, специализирующийся на анализе данных поддержки.

### Как работает

```
Менеджер: "Какие категории имеют самый низкий resolution rate?"
                    │
                    ▼
            ┌───────────────┐
            │ Analytics     │
            │ Agent         │
            │               │
            │ 1. Понимает   │
            │    вопрос     │
            │               │
            │ 2. Генерирует │
            │    SQL запрос  │
            │    (из 6 слоёв│
            │    контекста) │
            │               │
            │ 3. Выполняет  │
            │    запрос     │
            │               │
            │ 4. Интерпре-  │
            │    тирует     │
            └───────┬───────┘
                    │
                    ▼
            "Самый низкий resolution rate у категории 
             'payment_issue' — 41.2%. Это на 18% ниже 
             среднего (59.3%). Основная причина — 23% 
             тикетов застревают на этапе customer 
             identification. Рекомендация: улучшить 
             flow идентификации для payment тикетов."
```

### 6 слоёв контекста (self-learning)

| Слой | Что содержит | Пример |
|------|-------------|--------|
| 1. Схема таблиц | Структура БД, связи, типы данных | "support_threads_data.status — TEXT, значения: ..." |
| 2. Бизнес-правила | Определения метрик, формулы | "Resolution rate = Draft Created / AI Answered × 100%" |
| 3. Паттерны запросов | Проверенные SQL-запросы | "Для resolution rate по категориям — проверенный SQL" |
| 4. Документация | Правила системы, инструкции | "10 категорий, их определения и подтипы" |
| 5. Learnings | Ошибки и исправления (накапливаются) | "Поле X — TEXT, не INT. JOIN по customer_id" |
| 6. Live schema | Актуальная структура БД | Автоматическая интроспекция |

**Ключевое свойство:** Чем больше вопросов задаёшь — тем точнее ответы. Ошибки автоматически сохраняются и больше не повторяются.

### Примеры использования

**Операционная аналитика (ежедневно):**
- "Сколько тикетов AI обработал сегодня?"
- "Покажи застрявшие тикеты за последние 24 часа"
- "Какой процент тикетов не прошёл customer identification?"

**AI vs Human сравнение (еженедельно):**
- "Сравни качество AI и человеческих ответов для shipping"
- "Средний penalty score AI за эту неделю?"
- "Где AI ошибается чаще всего?"

**Стратегические решения:**
- "Какие категории готовы к auto-send? Покажи данные"
- "Сколько человеко-часов экономит AI?"
- "Тренд resolution rate по месяцам за полгода"

---

## 7. Инфраструктура: Монорепо + Docker контейнеры

### Принцип

Все сервисы живут в одном репозитории (monorepo), но каждый — в своём Docker контейнере:

- **Единое место** для всего кода, конфигов и документации
- **Независимый деплой** — обновить AI Engine, не трогая Omnichannel Hub
- **Одна команда** для запуска всего: `docker compose up`
- **Изоляция** — падение одного сервиса не ломает остальные

### Структура репозитория

```
lev-haolam-ai-platform/
│
├── docker-compose.yml              # Поднимает все сервисы
├── docker-compose.dev.yml          # Dev overrides (hot reload)
├── .env                            # Переменные окружения
│
├── services/
│   ├── ai-engine/                  # Сервис 2: AI Engine
│   │   ├── Dockerfile
│   │   ├── agents/                 # Router, Support Agent
│   │   ├── tools/                  # subscription, shipping, damage...
│   │   ├── knowledge/              # Knowledge base configs
│   │   ├── guardrails/             # Safety rules
│   │   └── config/                 # Category configs, model mapping
│   │
│   ├── omnichannel-hub/            # Сервис 1: Omnichannel Hub
│   │   ├── Dockerfile
│   │   └── config/                 # Channel configs, webhooks
│   │
│   ├── eval-lab/                   # Сервис 3: Eval Lab
│   │   ├── Dockerfile
│   │   ├── test-sets/              # Exported test data
│   │   └── evaluators/             # Custom evaluation scripts
│   │
│   ├── analytics-agent/            # Сервис 4: Analytics Agent
│   │   ├── Dockerfile
│   │   └── knowledge/              # Schemas, query patterns, rules
│   │
│   └── workflow-engine/            # Сервис 5: уже работает
│       └── config/
│
├── shared/
│   ├── database/                   # Миграции, схема БД
│   └── scripts/                    # Утилиты, экспорт данных
│
└── docs/                           # Документация
```

### Взаимодействие сервисов

```
┌──────────────────────────────────────────────────────────┐
│                    Docker Compose Network                  │
│                                                          │
│  ┌───────────────┐         ┌──────────────────┐         │
│  │ Omnichannel   │ webhook │   AI Engine      │         │
│  │ Hub           │────────►│                  │         │
│  │               │◄────────│   :8000          │         │
│  │   :3000       │ response│                  │         │
│  └───────────────┘         └────────┬─────────┘         │
│                                     │                    │
│                          ┌──────────┼──────────┐        │
│                          ▼          ▼          ▼        │
│                    ┌──────────┐ ┌────────┐ ┌────────┐   │
│                    │PostgreSQL│ │ Vector │ │External│   │
│                    │  :5432   │ │ Store  │ │ APIs   │   │
│                    └──────────┘ │(cloud) │ └────────┘   │
│                          ▲     └────────┘               │
│                          │                               │
│  ┌───────────────┐       │     ┌──────────────────┐     │
│  │ Eval Lab      │───────┘     │ Analytics Agent  │     │
│  │   :4000       │─────────────│   :9000          │     │
│  └───────────────┘  reads DB   └──────────────────┘     │
│                                                          │
│  ┌───────────────┐                                       │
│  │ Workflow Engine│  (уже работает, подключается)        │
│  │   :5678       │                                       │
│  └───────────────┘                                       │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 8. Безопасность и приватность

| Принцип | Реализация |
|---------|-----------|
| **Data sovereignty** | Все данные — в нашей БД. Ничего не уходит наружу (кроме LLM API) |
| **Zero egress tracing** | Трейсинг и логи в нашей БД, UI подключается напрямую из браузера |
| **JWT + RBAC** | Каждый запрос аутентифицирован, role-based access |
| **Request isolation** | Сессии пользователей изолированы |
| **Red lines** | Жёсткие ограничения, которые AI никогда не нарушает |
| **Human-in-the-loop** | Опасные действия требуют подтверждения |
| **Audit trail** | Полная история: кто спросил, что ответил AI, какие actions |

### Red Lines (никогда не нарушаются)

- AI **никогда** не подтверждает отмену/паузу напрямую — только через self-service или подтверждение
- AI **никогда** не раскрывает внутренние данные системы клиенту
- AI **никогда** не обещает возврат средств без авторизации
- Угрозы, юридические заявления, bank disputes → немедленная эскалация на человека
- Все действия с подпиской → human-in-the-loop confirmation

---

## 9. Roadmap: 6 фаз

### Phase 0: Foundation
**Цель:** Рабочий AI Engine + Management Console

- Развернуть AI Engine с базовым Support Agent (Docker)
- Подключить Vector Store (FAQ knowledge base)
- Подключить Management Console — playground + tracing
- Настроить Visual Builder
- Первые test cases через built-in evals

**Результат:** Можно чатить с AI в Console, видеть трейсы, тестировать сценарии.

---

### Phase 1: Agent Tuning + Evals
**Цель:** Настроенные промпты для всех 10 категорий

- Настроить промпты для каждой категории (перенос из текущей системы)
- Тестировать через Console Chat — разные сценарии
- Evals для accuracy/reliability/performance
- Сравнить модели — определить лучшую per category
- Настроить guardrails и red lines

**Результат:** AI отвечает на все 10 категорий с настроенным качеством.

---

### Phase 2: Chat Widget + Omnichannel
**Цель:** Виджет на сайте, AI отвечает на вопросы

- Развернуть Omnichannel Hub (Docker)
- Настроить виджет чата на сайте
- Подключить webhook: Omnichannel Hub → AI Engine
- Customer identification (email verification)
- Read-only tools: просмотр подписки, статус доставки, история

**Результат:** Клиент чатит на сайте, AI отвечает и показывает информацию.

---

### Phase 3: Action Tools + Eval Lab
**Цель:** AI выполняет действия + глубокое тестирование

- Action tools: пауза, skip, смена адреса, damage claim
- Human-in-the-loop: подтверждение действий в виджете
- Развернуть Eval Lab (Docker)
- Импорт исторических тикетов → массовое тестирование
- Side-by-side model comparison, LLM-as-Judge
- Ручная верификация сложных кейсов

**Результат:** AI выполняет действия. Качество проверено на тысячах тикетов.

---

### Phase 4: Retention + Escalation
**Цель:** Retention flow + передача человеку

- Retention agent: deep reasoning, персональные предложения
- Escalation: AI → человек в том же окне (через Omnichannel Hub)
- Персонализированные ссылки для self-service
- Дополнительные каналы: WhatsApp, Email

**Результат:** Полный retention flow. AI: 80-90%, человек: 10-20%.

---

### Phase 5: Analytics + Production Polish
**Цель:** Аналитика + production readiness

- Развернуть Analytics Agent (Docker)
- Создать knowledge base: schemas, query patterns, rules
- Запустить Learning Machine
- Production мониторинг
- Feedback loop: production → eval → improvement

**Результат:** Аналитика на естественном языке. Production-ready.

---

### Phase 6: Scale
**Цель:** Масштабирование

- Расширение auto-send на все категории
- Новые каналы (Telegram, Facebook Messenger)
- Multi-agent team для сложных кейсов
- Оптимизация стоимости
- Cross-user learnings
- Интеграция с CRM для проактивной поддержки

---

## 10. Ожидаемые результаты

### Операционные метрики

| Метрика | Сейчас (email) | Цель (chat platform) |
|---------|----------------|---------------------|
| Время ответа | 15-60 минут | **< 10 секунд** |
| AI auto-resolve rate | ~60% (1 категория) | **80-90%** (все категории) |
| Каналы | 1 (email) | **5+** (chat, WhatsApp, FB, email, Telegram) |
| Human agent workload | 100% review + actions | **10-20%** (только escalations) |
| Cost per ticket | $$$ (human time) | **$0.01-0.05** (LLM cost) |

### Стратегические преимущества

- **Масштабируемость** — 10x тикетов не требует 10x агентов
- **Самообучение** — система улучшается без ручной работы
- **Data-driven решения** — аналитика на естественном языке
- **Multi-channel** — клиент выбирает канал, мы видим всё в одном месте
- **Audit trail** — полная прозрачность: что AI сделал и почему

---

## 11. Стек платформы (итого)

| Сервис | Назначение | Статус |
|--------|-----------|--------|
| **AI Engine** | Агенты, tools, learning, API, console | Новый |
| **Omnichannel Hub** | Все каналы, виджет, handoff | Новый |
| **Eval Lab** | Тестирование, model comparison, quality | Новый |
| **Analytics Agent** | Self-learning аналитика | Новый |
| **Workflow Engine** | Email pipeline, jobs, мониторинг | Уже работает |
| **Database (PostgreSQL)** | Сессии, memory, traces, instructions | Уже работает |
| **Vector Store** | Knowledge base, FAQ, примеры | Уже работает |

**Всё self-hosted, всё в Docker, все данные у нас.**

